{% extends "baselayout.html" %}
{% block body %}

<script type='text/javascript' src="{{ url_for('static', filename='js/topojson.v1.min.js') }}"></script>

<style>
svg {
  background: #000;
}

.sphere {
  fill: #000;
}

.land {
  fill: #000;
}

.boundary {
  fill: none;
  stroke: #4a96ad;

  /* next three lines maintains neatness when zoomed in*/
  stroke-linejoin: round;
  stroke-linecap: round;
  vector-effect: non-scaling-stroke;

}

/* whats the use of overlay?*/
.overlay {
  fill: none;
  pointer-events: all;
}

</style>

<title>World Map</title>
<h1>Mapping</h1>
<p>basic Mercator projection </p>
<ul>
    <li>projections</li>
    <li>topojson and geojson object structure</li>
    <li>zoomable map</li>
</ul>

<div class = "frame1"></div>

<p style="font-size:11px"><a href="{{url_for('learnbydoing')}}"> <-- see more d3js blocks</a></p>


<script>

var width = 1024,
    height = 750;

var projection = d3.geo.mercator()
    .translate([width / 2, height / 2])
    .scale((width - 1) / 2 / Math.PI);

var zoom = d3.behavior.zoom()
    .scaleExtent([1, 8])
    .on("zoom", zoomed);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select(".frame1").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g");

var g = svg.append("g");

svg.append("rect")
    .attr("class", "overlay")
    .attr("width", width)
    .attr("height", height);

svg
    .call(zoom)
    .call(zoom.event);

d3.json("{{ url_for('static', filename='data/world-topo.json') }}", function(error, world) {
// d3.json("{{ url_for('static', filename='data/aruba.json') }}", function(error, world) {
  // g.append("path")
  //     .datum({type: "Sphere"})
  //     .attr("class", "sphere")
  //     .attr("d", path);

  g.append("path")
      .datum(topojson.merge(world, world.objects.countries.geometries))
      .attr("class", "land")
      .attr("d", path);

  g.append("path")
      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a === b; }))
      .attr("class", "boundary")
      .attr("d", path);

  g.append("path")
      .datum(topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }))
      .attr("class", "boundary")
      .attr("d", path);
});

function zoomed() {
  g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
}

d3.select(self.frameElement).style("height", height + "px");

</script>


{% endblock %}
