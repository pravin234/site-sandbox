{% extends "baselayout.html" %}
{% block body %}

<style>
    body { font-family: 'Lato', sans-serif; color: #3d3d3d; margin: 0; }
</style>

<title>Git Time Machine</title>
<h1>Git Time Machine</h1>

<br>
<h2> The greatest hits from 2012 to today </h2>
<br>

<div class="btn-toolbar" role="toolbar">
    <div class="btn-group">
      <button type="button" id='2012-03' class="btn btn-default">Mar</button>
      <button type="button" id="2012-04" class="btn btn-default">Apr</button>
      <button type="button" id="2012-05" class="btn btn-default">May</button>
      <button type="button" id="2012-06" class="btn btn-default">Jun</button>
      <button type="button" id="2012-07" class="btn btn-default">Jul</button>
      <button type="button" id="2012-08" class="btn btn-default">Aug</button>
      <button type="button" id="2012-09" class="btn btn-default">Sep</button>
      <button type="button" id="2012-10" class="btn btn-default">Oct</button>
      <button type="button" id="2012-11" class="btn btn-default">Nov</button>
      <button type="button" id="2012-12" class="btn btn-default">Dec</button>
    </div>
    <div class="btn-group">
        <button type="button" class="btn btn-default">Left</button>
        <button type="button" class="btn btn-default">Middle</button>
        <button type="button" class="btn btn-default">Right</button>
    </div>
    <div class="btn-group">
        <button type="button" class="btn btn-default">Left</button>
        <button type="button" class="btn btn-default">Middle</button>
        <button type="button" class="btn btn-default">Right</button>
    </div>
</div>



<div class = "frame">
    <div class = "tooltip"></div>
</div>

<p style="font-size:11px"><a href="{{url_for('learnbydoing')}}"> <-- see more d3.js blocks</a></p>

<script>
    var width = 800,
        height = 400;

    var colHt = 35;

    var nCols = 10;
    var color = d3.scale.category20();

    var chart = d3.selectAll(".frame").append("svg")
                .attr("width", width)
                .attr("height", height);
                // remove this later, for estimation only
                // .style('background','steelblue');

    var defaultFilter ='2012-03';

d3.csv("{{ url_for('static', filename='billboard_top_10.csv') }}", function(error, data) {

  data.forEach(function(d) {
    d.new_stars = +d.new_stars;
  });

  var x = d3.scale.linear()
    //fix later only works for 2013, domain must update on max(new_stars)
      .domain([0,5000])
      .range([0,height]);

    var rect = chart.selectAll("rect")
        .data(data)
        .enter().append("rect")
            .filter(function(d) {return d.month == defaultFilter;})
                .attr("y", function(d,i) { return i * (colHt + 2) ; })
                .attr("width",0)
                .attr("height", colHt )
                .style("fill", "#999");
                // .style("fill", function(d,i) { return color(i);} )

    rect.transition()
        .attr("width", function(d) { return x(d.new_stars);})
        .duration(800);

    var nameText = chart.selectAll("text")
        .data(data)
        .enter().append("text")
            .filter(function(d) {return d.month == defaultFilter;})
            .attr("dy", function(d,i) { return i * (colHt+2) + (colHt/2+5); })
            .attr("x", 10 )
            .text( function(d) {  return d.repository_name;} );



 $('button').click(function(){
     //`this` gives me all attributes of the button
    //  console.log(this);
     //`this.id` gives me the id, which i can use to filter!! but its not matching...
     console.log(String(this.id));

     //omg in javascript == and === are not the same
    //  console.log(String(this.id) === defaultFilter);

    var newFilter = String(this.id);

    var rct = chart.selectAll("rect")
        .data(data.filter(function(d) {console.log(d[0]); return d.month === newFilter;}))
        .transition()
            .attr("y", function(d,i) { return i * (colHt + 2) ; })
            .attr("width", function(d) { return x(d.new_stars);})
            .attr("height", colHt )
            .style("fill", "#999")
            .duration(500);

    var txt = chart.selectAll("text")
    // to get a subset, filter in here
       .data(data.filter(function(d) {return d.month === newFilter;}));


    txt.attr("dy", function(d,i) { return i * (colHt+2) + (colHt/2+5); })
            .attr("x", 10)
            .text( function(d) {  return d.repository_name;} );

    txt.exit().remove();



 });

});

</script>


{% endblock %}
